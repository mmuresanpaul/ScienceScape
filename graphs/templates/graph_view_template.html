
{% load static %}


<style>
    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      height: 500px;
    }
 </style>


    <div class="white-text center graphs-page">

        <div class="card graphs-buttons-card">
            <div class="card-content">

                <h5> Graph Controls (partial functionality)</h5>

                    <div class="row">
                        <div class="col s6">
                            <a class="waves-effect waves-light btn graph-select" onclick="startStopForceAtlas2(this)" id="start-force-atlas-2"><i class="material-icons left">play_arrow</i>Start Force Atlas 2</a>
                            <br>
                         </div>

                        <div class="col s6">
                            <a class="waves-effect waves-light btn graph-select" id="reset"><i class="material-icons left">power_settings_new</i>Reset</a><br>
                            <a class="waves-effect waves-light btn graph-select"  onclick="rearrageIntoCircle(this)" id="rearrange-to-circle"><i class="material-icons left">refresh</i>Rearrange to Circle</a>
                        </div>

                        <div class="col s6">
                            <br>
                            <div class="switch toggle-graph-edges">
                                Graph Edges
                                <label>
                                  Off
                                  <input onclick="turnOnOffEdges(this)"  type="checkbox" id="graph-edges">
                                  <span class="lever"></span>
                                  On
                                </label>
                            </div>
                        </div>

                        <div class="col s6">
                            <form id="graph-node-search">
                                <div class="input-field">
                                  <input id="search" type="search" placeholder="Node Search" required>
                                  <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                                  <i class="material-icons">close</i>
                                </div>
                            </form>
                        </div>
                    </div>
            </div>
        </div>

    </div>
    


<div class="card">
	<div class="card-content">
	<h5>{{filename}}</h5>

  	<div  id="graph-container"></div>

	</div>
</div>

<!-- START SIGMA IMPORTS -->
<script src="{% static 'javascript/sigma.js-1.2.1/src/sigma.core.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/conrad.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/utils/sigma.utils.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/utils/sigma.polyfills.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/sigma.settings.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.dispatcher.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.configurable.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.graph.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.camera.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.quad.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/classes/sigma.classes.edgequad.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/captors/sigma.captors.mouse.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/captors/sigma.captors.touch.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/sigma.renderers.canvas.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/sigma.renderers.webgl.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/sigma.renderers.svg.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/sigma.renderers.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/webgl/sigma.webgl.nodes.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/webgl/sigma.webgl.nodes.fast.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/webgl/sigma.webgl.edges.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/webgl/sigma.webgl.edges.fast.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/webgl/sigma.webgl.edges.arrow.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.labels.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.hovers.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.nodes.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edges.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edges.curve.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edges.arrow.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.curve.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/canvas/sigma.canvas.extremities.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.utils.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.nodes.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.edges.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.edges.curve.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.labels.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/renderers/svg/sigma.svg.hovers.def.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/middlewares/sigma.middlewares.rescale.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/middlewares/sigma.middlewares.copy.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/misc/sigma.misc.animation.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/misc/sigma.misc.bindEvents.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/misc/sigma.misc.bindDOMEvents.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/src/misc/sigma.misc.drawHovers.js'%}"></script>
<!-- END SIGMA IMPORTS -->
<script src="{% static 'javascript/sigma.js-1.2.1/plugins/sigma.parsers.gexf/gexf-parser.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/plugins/sigma.parsers.gexf/sigma.parsers.gexf.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/plugins/sigma.layout.forceAtlas2/worker.js'%}"></script>
<script src="{% static 'javascript/sigma.js-1.2.1/plugins/sigma.layout.forceAtlas2/supervisor.js'%}"></script>

<script>


var graphs = [];
var toggleEdges = true;
console.log("graph presented is: " + "{% static fpath%}");

sigma.parsers.gexf("{% static fpath%}", {container: 'graph-container'},

	function (sigmaObject) {

		var numberOfNodes = sigmaObject.graph.nodes().length;
		var counter = 0;

		sigmaObject.graph.nodes().forEach(function(n) {

		 if(!n.x && !n.y){
		  n.x =100 * Math.cos(2 * counter * Math.PI / numberOfNodes);
    	  n.y =100 * Math.sin(2 *  counter * Math.PI / numberOfNodes);
    	 }

    	  if (!n.label) {
    	  	n.label = n.id;
    	  }

    	  if(!n.size){
    	  	n.size = Math.random();
    	  }

        counter ++ ;
      });



      sigmaObject.refresh();
      graphs.push(sigmaObject);

	}
);


function startStopForceAtlas2(element){
	console.log("no. graphs: " + graphs.length)
	if(graphs.length > 0){
		if (!graphs[0].isForceAtlas2Running()){
		//start spacialization
			for (i=0 ; i<graphs.length; i++) {
				graphs[i].startForceAtlas2({worker: true, barnesHutOptimize: false});
			}
			
			element.innerHTML="<i class=\"material-icons left\">play_arrow</i>Start Force Atlas 2";
			element.classList.add("btn-danger");
			element.classList.remove("btn-success");
	
		} else {
		//stop spacialsation
		for (i = 0 ; i<graphs.length; i++) {
			graphs[i].stopForceAtlas2();
		}
		element.innerHTML="<i class=\"material-icons left\">stop</i>Stop Force Atlas 2";
		element.classList.add("btn-success");
			element.classList.remove("btn-danger");
		}
	}

}

function rearrageIntoCircle(element) {
	console.log("Rearrange circle pressed");
	if(graphs.length > 0){
	
		for (i=0 ; i<graphs.length ; i++) {
			var counter = 0;
			var numberOfNodes = graphs[i].graph.nodes().length;
			graphs[i].graph.nodes().forEach(function(n) {
	
			  n.x =100 * Math.cos(2 * counter * Math.PI / numberOfNodes);
	    	  n.y =100 * Math.sin(2 *  counter * Math.PI / numberOfNodes);
	
	    	  n.size = Math.random();
				counter++;
	      });
	      graphs[i].killForceAtlas2();
	           graphs[i].refresh();
		}
	
	}
}

function turnOnOffEdges(element) {
	console.log("ToggleEdges pressed: " + toggleEdges);
	if(graphs.length > 0){
		
		if (toggleEdges) {
			for (i=0 ; i<graphs.length ; i++) {
				graphs[i].settings('drawEdges', false);
				graphs[i].refresh();
			}
	
			toggleEdges = false;
		} else {
			for (i=0 ; i<graphs.length ; i++) {
				graphs[i].settings('drawEdges', true);
				graphs[i].refresh();
			}
	
			toggleEdges = true;
		}
	}
}

</script>
